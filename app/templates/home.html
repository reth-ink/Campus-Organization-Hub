{% extends 'base.html' %}

{% block content %}

<div class="home-layout">

    <!-- LEFT SIDEBAR: Joined Organizations -->
    <aside class="left-sidebar">
        <h3>Joined Organizations</h3>
        <ul class="joined-orgs">
            {% for org in joined_orgs %}
            <li class="org-item">
                <a href="{{ url_for('web.org_detail', org_id=org.OrgID) }}" class="event-link">{{ org.OrgName }}</a>
            </li>
            {% endfor %}
        </ul>
    </aside>

    <!-- MIDDLE COLUMN: Announcements -->
<main class="feed">
    <h2 class="section-title">Announcements</h2>

    {% for announcement in announcements %}
    <div class="post-card">

        <!-- Badge / Flair -->
        {% if announcement.flair %}
        <span class="post-flair">{{ announcement.flair }}</span>
        {% endif %}

        <h3 class="post-title">{{ announcement.Title }}</h3>

        <p class="post-body">{{ announcement.Content }}</p>

        <div class="post-meta">
            <span class="post-time">{{ announcement.DatePosted }}</span>
            {% if announcement.CreatorName %} &middot; Posted by: {{ announcement.CreatorName }}{% endif %}
        </div>
        {% if announcement.Attachments %}
            <div style="margin-top:8px;">
                {% for a in announcement.Attachments %}
                    {% if a.type == 'image' %}
                        <div style="margin-bottom:8px;"><img src="{{ a.url }}" alt="attachment" style="max-width:100%;height:auto;border-radius:8px;" /></div>
                    {% elif a.type == 'video' %}
                        <div style="margin-bottom:8px;"><video controls style="max-width:100%;height:auto;"><source src="{{ a.url }}" type="{{ a.mimetype }}">Your browser does not support the video tag.</video></div>
                    {% elif a.type == 'link' %}
                        <div style="margin-bottom:6px;"><a href="{{ a.url }}" target="_blank" rel="noopener" class="event-link">{{ a.url }}</a></div>
                    {% else %}
                        <div style="margin-bottom:6px;"><a href="{{ a.url }}" download class="event-link">{{ a.filename or a.url }}</a></div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}

        {% if announcement.link %}
        <a href="{{ announcement.link }}" class="post-button">View Details</a>
        {% endif %}
    </div>
    {% endfor %}
</main>

    <!-- RIGHT SIDEBAR: Events + Organizations -->
    <aside class="sidebar">

        <!-- Events Panel -->
        <div class="sidebar-box">
            <h3 class="sidebar-title">Upcoming Events</h3>
            <div class="upcoming-panel" style="max-height:260px; overflow:auto; padding:6px; border:1px solid #eee; border-radius:6px;">
            {% if events %}
                {% for event in events[:5] %}
                <div class="event-item">
                    <a class="event-link" href="{{ url_for('web.event_detail', event_id=event.EventID) }}">{{ event.EventName }}</a>
                    <div class="event-time">{{ event.EventDate }}</div>
                </div>
                {% endfor %}
            {% else %}
                <p>No upcoming events.</p>
            {% endif %}
            </div>
            <div style="margin-top:8px; text-align:center;">
                <a class="event-link" href="{{ url_for('web.events') }}">View all events</a>
            </div>
        </div>

        <!-- Organizations Panel -->
        <div class="sidebar-box" style="margin-top: 20px;">
            <h3 class="sidebar-title">Organizations</h3>
            {% for org in orgs %}
            <div class="event-item">
                <a class="event-link" href="{{ url_for('web.org_detail', org_id=org.OrgID) }}">
                    {{ org.OrgName }}
                </a>
            </div>
            {% endfor %}
        </div>

    </aside>

</div>

{% endblock %}
